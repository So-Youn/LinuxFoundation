# System Monitoring

**Table: Process and Load Monitoring Utilities**

## /proc

* **/proc** filesystem은 process 및 system을 모니터링하는데 도움을 준다.
  * 커널 데이터 구조에 대한 인터페이스로, /proc에는 PID로 명명된 활성 프로세스에 대한 하위 디렉토리가 있다.
  * `/proc/self` 는 현재 실행중인 프로세스

| UTILITY      | PURPOSE                                                  | PACKAGE                    |
| :----------- | :------------------------------------------------------- | :------------------------- |
| **top**      | Process activity, dynamically updated                    | **procps**                 |
| **uptime**   | How long the system is running and the average load      | **procps**                 |
| **ps**       | Detailed information about processes                     | **procps**                 |
| **pstree**   | A tree of processes and their connections                | **psmisc** (or **pstree**) |
| **mpstat**   | Multiple processor usage                                 | **sysstat**                |
| **iostat**   | CPU utilization and I/O statistics                       | **sysstat**                |
| **sar**      | Display and collect information about system activity    | **sysstat**                |
| **numastat** | Information about NUMA (Non-Uniform Memory Architecture) | **numactl**                |
| **strace**   | Information about all system calls a process makes       | **strace**                 |

* `ps` : 현재 실행중인 프로세스 목록과 상태

  * `ps -elf` `ps aux`

  * 출력 순서 바꾸기

    ```shell
    [root@bef06f544a92 /]# ps -o pid,pri,ni,cmd
      PID PRI  NI CMD
        1  19   0 bash
       16  19   0 ps -o pid,pri,ni,cmd
    ```

  * 실습

    > dd를 사용해서 /dev/urandom에서 읽은 background process를 /dev/null에 쓰기

    ```shell
    [root@bef06f544a92 /]# dd if=/dev/urandom of=/dev/null &
    [1] 40
    [root@bef06f544a92 /]# ps -C dd -o pid,cmd,stat
      PID CMD                         STAT
       40 /usr/bin/coreutils --coreut RN
    ```

    > fg 사용해서 프로세스 가져온뒤 중지시키기

    ```shell
    [root@bef06f544a92 /]# fg
    dd if=/dev/urandom of=/dev/null
    ^Z
    [1]+  Stopped                 dd if=/dev/urandom of=/dev/null
    [root@bef06f544a92 /]# ps -C dd -o pid,cmd,stat
    '  PID CMD                         STAT
       40 /usr/bin/coreutils --coreut TN
    [root@bef06f544a92 /]# jobs
    [1]+  Stopped                 dd if=/dev/urandom of=/dev/null
    [root@bef06f544a92 /]# 
    ```

    

  

* `top` : cpu 사용이 가장 높은 프로세스 표시

```shell
[root@eef676fd512f yum.repos.d]# pstree
bash─┬─pstree
     └─top
[root@eef676fd512f yum.repos.d]# mpstat
Linux 5.10.47-linuxkit (eef676fd512f) 	04/16/2022 	_aarch64_	(4 CPU)

05:14:21 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
05:14:21 PM  all    0.48    0.00    0.69    0.04    0.00    0.11    0.00    0.00    0.00   98.68
[root@eef676fd512f yum.repos.d]# iostat
Linux 5.10.47-linuxkit (eef676fd512f) 	04/16/2022 	_aarch64_	(4 CPU)

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           0.48    0.00    0.79    0.04    0.00   98.69

Device             tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn
vda              16.45       215.37       280.71     536611     699388
```



**Table: Memory Monitoring Utilities**

| UTILITY    | PURPOSE                                                      | PACKAGE    |
| :--------- | :----------------------------------------------------------- | :--------- |
| **free**   | Brief summary of memory usage                                | **procps** |
| **vmstat** | Detailed virtual memory statistics and block I/O, dynamically updated | **procps** |
| **pmap**   | Process memory map                                           | **procps** |





**Table: I/O Monitoring Utilities**

| UTILITY    | PURPOSE                                                      | PACKAGE     |
| :--------- | :----------------------------------------------------------- | :---------- |
| **iostat** | CPU utilization and I/O statistics                           | **sysstat** |
| **sar**    | Display and collect information about system activity        | **sysstat** |
| **vmstat** | Detailed virtual memory statistics and block I/O, dynamically updated | **procps**  |

* `sar` : system activity나 performance data를 수집하는 목적.
  * `/var/log/sa` 에 data가 저장된다.
    * `/etc/cron.d/sysstat` 에 cron job 등록되어 있음
  * `$ sar [option] [interval] [count]`

```shell
[root@eef676fd512f yum.repos.d]# sar 3 3
Linux 5.10.47-linuxkit (eef676fd512f) 	04/16/2022 	_aarch64_	(4 CPU)

05:17:47 PM     CPU     %user     %nice   %system   %iowait    %steal     %idle
05:17:50 PM     all      0.00      0.00      0.25      0.00      0.00     99.75
05:17:53 PM     all      0.00      0.00      0.25      0.00      0.00     99.75
05:17:56 PM     all      0.33      0.00      0.25      0.08      0.00     99.33
Average:        all      0.11      0.00      0.25      0.03      0.00     99.61

[root@eef676fd512f yum.repos.d]# vmstat
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 2  0   3616 227616  60796 1249816    0    0    57    74  252  398  0  1 99  0  0
```



**Table: Network Monitoring Utilities**

| UTILITY       | PURPOSE                                          | PACKAGE       |
| :------------ | :----------------------------------------------- | :------------ |
| **netstat**   | Detailed networking statistics                   | **netstat**   |
| **iptraf**    | Gather information on network interfaces         | **iptraf**    |
| **tcpdump**   | Detailed analysis of network packets and traffic | **tcpdump**   |
| **wireshark** | Detailed network traffic analysis                | **wireshark** |

## log

* 시스템 로그 확인 법
  * `/var/log/messages`
  * `dmesg -w`
* `boot.log` : 시스템 boot message
* `dmes` : boot된 후에 저장된 kernel message
*  `secure`





